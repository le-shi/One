# 在Linux中模拟多种系统负载

## 内存
```bash
# 下面命令会减少可用内存的总量。它是通过在内存中创建文件系统然后往里面写文件来实现的。你可以使用任意多的内存，只需哟往里面写入更多的文件就行了。

# 1. 创建一个挂载点，然后将 ramfs 文件系统挂载上去：
mkdir z
mount -t ramfs ramfs z/
# 2. 使用 dd 在该目录下创建文件。这里我们创建了一个 128M 的文件：
dd if=/dev/zero of=z/file bs=1M count=128

# 文件的大小可以通过下面这些操作符来修改：
# bs= 块大小。可以是任何数字后面接上 B(表示 byte)，K(表示 KB)，M(表示 MB)或者 G(表示 GB)。
# count= 要写多少个块。
```


## CPU
使用 lookbusy 工具实现
```bash
# 先安装一下
wget http://www.devin.com/lookbusy/download/lookbusy-1.4.tar.gz
tar -xzf lookbusy-1.4.tar.gz
cd lookbusy-1.4
./configure
make
sudo make install
cd ../
rm -rf lookbusy-1.4*
```

```bash
# 开始使用
# 让所有 CPU 的使用率都是 50%
lookbusy -c 50
# 让两个 CPU 的使用率都是 30%
lookbusy -c 30 -n 2
# 让所有 CPU 的使用率在 50%-80% 之间左右浮动
lookbusy -c 50-80 -r curve
# 让所有 CPU 的使用率在 20%-%80 之间，周期为24小时，在14点(下午2点)达到峰值
lookbusy --cpu-mode curve --cpu-curve-peak 14h -c 20-80
# 让所有 CPU 以60分钟为周期，30分钟是峰值，使用率在 20%-30% 之间
lookbusy -c 20-30 --cpu-mode curve --cpu-curve-period 60m --cpu-curve-peak 30m

# 每 1000 毫秒，循环释放并分配 128MB 内存
lookbusy -c 0 -m 128MB -M 1000
# 每 10 毫秒，循环进行 1MB 磁盘写入，临时文件不超过 1GB
lookbusy -c 0 -d 1GB -b 1MB -D 10

# 手动拉满所有CPU，可以执行命令 `pkill -9 dd` 停止下面的进程）：
for i in `seq 1 $(cat /proc/cpuinfo |grep "physical id" |wc -l)`; do dd if=/dev/zero of=/dev/null & done
```





## 磁盘使用率
`dd` 命令结合 `/dev/zero` 可以用于输出一定大小的文件，从而模拟磁盘使用率。

```bash
# 输出 1024M 的 0 到 loadfile
dd if=/dev/zero of=loadfile bs=1M count=1024
```

## 磁盘 IO
利用刚刚生成的 loadfile，加上 cp 命令可以一定程度地模拟顺序 IO：

```bash
# 启动一个运行10次的循环。每次运行时，它会复制 loadfile 在 loadfile1
for i in {1..10}; do cp loadfile loadfile1; done

# 无限循环复制文件
while true; do cp loadfile loadfile1; done
```
